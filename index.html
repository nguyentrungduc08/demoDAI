<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Dynamic Ad Insertion</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="style.css">

    <link rel="preload" href="dist/hls-demo.js" as="script">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
  </head>

  <body>
    <div class="header-container">
      <header class="wrapper clearfix">
        <h2 >
          Dynamic Ad Insertion Demo
        </h2>
      </header>
    </div>


    <div class="container" id="listVideos">
      <!-- <h4>List Videos</h4> -->
      <span class="label label-primary">List Videos</span>
      <div class="row">
        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i1.jpg" style="width:100%" onclick="currentVideo(1)" alt="video 1">
          <figcaption style="text-align: right;">4:56</figcaption>
        </div>

        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i2.jpg" style="width:100%" onclick="currentVideo(2)" alt="video 2">
          <figcaption style="text-align: right;">04:11</figcaption>
        </div>
        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i3.jpg" style="width:100%" onclick="currentVideo(3)" alt="video 3">
          <figcaption style="text-align: right;">04:11</figcaption>
        </div>  
        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i4.jpg" style="width:100%" onclick="currentVideo(4)" alt="video 4">
          <figcaption style="text-align: right;">5:31</figcaption>
        </div>
        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i5.jpg" style="width:100%" onclick="currentVideo(5)" alt="video 5">
          <figcaption style="text-align: right;">5:20</figcaption>
        </div>
        <div class="column">
          <img class="demoVideo cursor video img-rounded" src="Resources/videos/i6.jpg" style="width:100%" onclick="currentVideo(6)" alt="video 6">
          <figcaption style="text-align: right;">3:55</figcaption>
        </div>
      </div>
    </div>

    <div class="container" id="listAds" style="pointer-events:none">
      <!-- <h4>List Ads</h4> -->
      <span class="label label-success">List Ads</span>
      <div class="row">
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/1.jpg" style="width:100%" id="1" alt="ads-1" title="abc">
          <figcaption style="text-align: right;" alt="04:11" id="ads-1">04:11</figcaption>
        </div>
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/2.jpg" style="width:100%" id="2" alt="ads-2">
          <figcaption style="text-align: right;" alt="02:13" id="ads-2">02:13</figcaption>
        </div>
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/2.jpg" style="width:100%" id="3" alt="ads-3">
          <figcaption style="text-align: right;" alt="04:11" id="ads-3">04:11</figcaption>
        </div>
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/3.jpg" style="width:100%" id="4" alt="ads-4">
          <figcaption style="text-align: right;" alt="04:11" id="ads-4">04:11</figcaption>
        </div>
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/1.jpg" style="width:100%" id="5" alt="ads-5">
          <figcaption style="text-align: right;" alt="04:11" id="ads-5">04:11</figcaption>
        </div>
        <div class="column">
          <img class="demoAds cursor ads img-rounded" src="Resources/ads/1.jpg" style="width:100%" id="6" alt="ads-6">
          <figcaption style="text-align: right;" alt="00:00" id="ads-6">04:11</figcaption>
        </div>
      </div>

<!--       <div class="caption-container">
        <p id="caption"></p>
      </div> -->
    </div>

    <div>
      <br>
      <br>
    </div>

    <div class="main-container container">
      <div class="col-xs-7">  
        <video id="video" width="640" height="360" controls autoplay poster="Resources/videos/i1.jpg"></video>

        <br>

        <div style="height: 10px; background-color: red; width: 640px">
            
        </div>

        <br>

        <div>
            <span id="titleVideoName" ></span>
        </div>
      </div>

      <div class="col-xs-5 table-responsive" style="height: 400px">  
        <table class="table table-striped table-responsive col-xs-5" id="tableAds">
            <tr>
                <col width="30%">
                <col width="30%">
                <col width="20%">
                <col width="20%">
                <th>Name</th>
                <th>Duration</th> 
                <th>Time</th>
                <th></th>
            </tr>
        </table>

        <div align="center">
          <input type="submit" name="insert" id="insert" class="btn btn-success" value="Play" onclick="playVideo()">
        </div>
      </div>

      <br>

      <canvas id="bufferedCanvas" height="15" class="videoCentered" onclick="onClickBufferedRange(event);"></canvas>

    </div>

    <footer>
      <br><br><br><br><br><br>  
    </footer>

    <!-- Demo page required libs -->
    <script src="canvas.js"></script>
    <script src="metrics.js"></script>
    <script src="jsonpack.js"></script>

    <script>
        $(document).ready(function(){
            $('#1').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-1');
                selectAd(1);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
            $('#2').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-2');
                var x = subMenuEl.attr('alt');
                selectAd(2);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
            $('#3').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-3');
                var x = subMenuEl.attr('alt');
                selectAd(3);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
            $('#4').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-4');
                var x = subMenuEl.attr('alt');
                selectAd(4);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
            $('#5').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-5');
                var x = subMenuEl.attr('alt');
                selectAd(5);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
            $('#6').click(function(e) {
                var item = $(this);
                var subMenuEl = item.parent().find('#ads-6');
                var x = subMenuEl.attr('alt');
                selectAd(6);
                var adname = $(this).attr('alt');
                insertToTableAds(adname, subMenuEl.attr('alt'));
            })
        });

      (function() {
        function loadScript(url, onLoad) {
          var s = document.createElement("script");
          s.setAttribute('src', url);
          if (onLoad) {
            s.onload = onLoad;
          }
          document.body.appendChild(s);
        }

        // load compiled lib dist, or latest canary from jsdelivr (?canary=true)
        var src = window.location.search.substring(1).split('&').indexOf('canary=true') >= 0
          ? 'https://cdn.jsdelivr.net/npm/hls.js@canary'
          : 'dist/hls.js';

        loadScript(src, function() {
          // load compiled demo main
          loadScript('dist/hls-demo.js');
        });
      })();

      var videoIndex = 1;
      var flagShowAd = 0;

      function deleteRow(btn) {
        var row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
      }

      function currentVideo(n) {
        flagShowAd = 1;
        selectVideo(slideIndex = n);
      }

      function currentAd(n) {
        if (flagShowAd == 1){
          selectAd(slideIndex = n);
        }
      }

      function insertToTableAds(adName, adTime) {
        // console.log(adTime);
        var table = document.getElementById("tableAds");
        var row = table.insertRow(2);

        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);

        cell1.innerHTML = adName;
        cell2.innerHTML = adTime;
        cell3.innerHTML = cell3.innerHTML + "<input type='text' name='insert' id='insert' class='form-control' placeholder='s'>";
        cell4.innerHTML = cell4.innerHTML + "<button tyep='button' name='remove_details' class='btn btn-danger btn-xs remove_details' id='2' onclick='deleteRow(this)'>Remove</button>";
      }

      function selectAd(n) {
        var i;
        var ads = document.getElementsByClassName("ads");

        for (i = 0; i < ads.length; i++) {
            ads[i].className = ads[i].className.replace(" active", "");
        }

        ads[n-1].className += " active";    
      }


      function selectVideo(n) {
        var i;
        var videos = document.getElementsByClassName("video");
        var listAds = document.getElementById("listAds");

        for (i = 0; i < videos.length; i++) {
            videos[i].className = videos[i].className.replace(" active", "");
        }

        videos[n-1].className += " active";
        var imgVideo = document.getElementById("video");
        imgVideo.poster = videos[n-1].src;
        listAds.style.pointerEvents = "fill";
      }

      function playVideo() {

        var video = document.getElementById("video");
        var videoSrcHls = "http://127.0.0.1:9090/test.m3u8";

        if(Hls.isSupported()) {
          var hls = new Hls();  
          hls.loadSource(videoSrcHls);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED,function() {
            video.play();
          });
        }
      }

    </script>
  </body>
</html>
